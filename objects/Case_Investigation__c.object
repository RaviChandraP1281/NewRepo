<?xml version="1.0" encoding="UTF-8"?>
<CustomObject xmlns="http://soap.sforce.com/2006/04/metadata">
    <enableEnhancedLookup>false</enableEnhancedLookup>
    <validationRules>
        <fullName>Case_ReadOnly_On_Investigation</fullName>
        <active>false</active>
        <description>Ensures that the initial case number associated with the investigation cannot be changed once populated</description>
        <errorConditionFormula>AND(NOT(ISNULL(Case__c )) , ISCHANGED( Case__c ))</errorConditionFormula>
        <errorDisplayField>Case__c</errorDisplayField>
        <errorMessage>The initial case that has been used to create the investigation cannot be changed</errorMessage>
    </validationRules>
    <validationRules>
        <fullName>Case_ReadOnly_for_Tier2</fullName>
        <active>false</active>
        <description>Ensures that the investigations are read only for tier2</description>
        <errorConditionFormula>AND(NOT(ISNEW()), OR($Profile.Name  = &apos;SB Care Agent Tier2&apos;,$Profile.Name  = &apos;SB Care DT and OL Tier2&apos;))</errorConditionFormula>
        <errorMessage>You cannot edit this investigation.Please Contact Supportability agent.</errorMessage>
    </validationRules>
    <validationRules>
        <fullName>Investigations_Read_only_for_tier2</fullName>
        <active>false</active>
        <description>To make investigations read only for Tier2 Profiles.</description>
        <errorConditionFormula>AND(NOT(ISNEW()), OR($Profile.Name = &apos;Tier2SBCareAgent&apos;,$Profile.Name = &apos;Tier2SBCDTandOL&apos;,$Profile.Name = &apos;Tier2SBOLCareAgent&apos;))</errorConditionFormula>
        <errorMessage>You do not have privileges to edit this investigation.Please Contact Supportability agent or System Administrator.</errorMessage>
    </validationRules>
    <validationRules>
        <fullName>Make_FDS_fields_read_only</fullName>
        <active>true</active>
        <description>FDS fields have to be read only when the status is locked and lock field is checked</description>
        <errorConditionFormula>IF(AND(OR(Locked__c = True,  ISPICKVAL(Status__c, &apos;FDS Managed&apos;) ), OR(ISCHANGED(Accounts_Impacted__c), ISCHANGED(Institution_ID__c),  ISCHANGED(Institution_Name__c),  ISCHANGED(Max_SLA__c)),  $User.ProfileId   &lt;&gt; &apos;00ei0000000rABN&apos;,  $User.ProfileId  &lt;&gt; &apos;00ei0000000rG9U&apos; ) , True, False)</errorConditionFormula>
        <errorMessage>You cannot change FDS fields as the status is FDS Managed or the record is locked</errorMessage>
    </validationRules>
    <validationRules>
        <fullName>Mandatory_Fields_To_create_a_new_Inv</fullName>
        <active>false</active>
        <description>Subject is mandatory to create a new Investigation.</description>
        <errorConditionFormula>OR(ISBLANK( Subject__c ),ISBLANK(  Impacted_Products__c  ),ISBLANK(  Impacted_Regions__c  ))</errorConditionFormula>
        <errorMessage>Please Enter the Mandatory fields details. 
Subject,Impacted Products and Impacted Product regions are mandatory to create an Investigation.</errorMessage>
    </validationRules>
    <validationRules>
        <fullName>Status_Locked</fullName>
        <active>true</active>
        <errorConditionFormula>(Locked__c  =  true) &amp;&amp;  ISCHANGED( Status__c )</errorConditionFormula>
        <errorMessage>Cannot update Status as the Investigation is locked</errorMessage>
    </validationRules>
    <validationRules>
        <fullName>Sub_Status_Locked</fullName>
        <active>true</active>
        <errorConditionFormula>(Locked__c  =  true) &amp;&amp;  ISCHANGED( Sub_Status__c )</errorConditionFormula>
        <errorMessage>Cannot update Sub-Status as the Investigation is locked</errorMessage>
    </validationRules>
    <validationRules>
        <fullName>Subject_is_Mandatory_To_create_a_new_Inv</fullName>
        <active>true</active>
        <description>Please Enter the Mandatory fields details.
Subject,Impacted Products and Impacted Product regions are mandatory to create an Investigation.</description>
        <errorConditionFormula>OR(ISBLANK( Subject__c ),ISBLANK(  Impacted_Products__c  ),ISBLANK(  Impacted_Regions__c  ))</errorConditionFormula>
        <errorMessage>Subject is mandatory to create a new Investigation.</errorMessage>
    </validationRules>
    <webLinks>
        <fullName>Associate_Cases</fullName>
        <availability>online</availability>
        <displayType>button</displayType>
        <linkType>javascript</linkType>
        <masterLabel>Associate Cases</masterLabel>
        <openType>onClickJavaScript</openType>
        <protected>false</protected>
        <url>{!REQUIRESCRIPT(&quot;/soap/ajax/30.0/connection.js&quot;)} 
{!REQUIRESCRIPT(&quot;/soap/ajax/30.0/apex.js&quot;)} 
{!REQUIRESCRIPT(&quot;/support/console/28.0/integration.js&quot;)} 

var user = sforce.connection.getUserInfo(); 
var userId = user.userId ; 
var HavePermission= sforce.apex.execute(&quot;getBU_Utility&quot;,&quot;getInvestigationPrivilegesMerge&quot;, {UserId:userId}); 
//alert(userBU); 
if(HavePermission== &apos;N&apos;){ 
alert(&apos;User is not authorized to Associate bulk cases to Investigations. Please contact system admin&apos;); 
} 
else{ 
if(typeof(srcUp) == &apos;function&apos;) //Checks that it is in console 
{  
var openSubtab = function(result){  
var label=&apos;Associate cases for &apos;+&apos;{!Case_Investigation__c.Name }&apos;; 
//alert(label); 
sforce.console.openSubtab(result.id,&apos;/apex/AssociateCase?id={!Case_Investigation__c.Id }&amp;inConsole=true&apos;, true, label, null);  
};  
sforce.console.getEnclosingPrimaryTabId(openSubtab);  

}  
else{  
window.open(&apos;/apex/AssociateCase?id={!Case_Investigation__c.Id}&amp;inConsole=false&apos;, &apos;_blank&apos;); 
} 

}</url>
    </webLinks>
    <webLinks>
        <fullName>Merge_Investigation</fullName>
        <availability>online</availability>
        <description>For Merging Investigstion</description>
        <displayType>button</displayType>
        <linkType>javascript</linkType>
        <masterLabel>Merge Investigation</masterLabel>
        <openType>onClickJavaScript</openType>
        <protected>false</protected>
        <url>/*{!REQUIRESCRIPT(&quot;/support/console/37.0/integration.js&quot;)} 
if(typeof(srcUp) == &apos;function&apos;) //Checks that it is in console
{ 
var openSubtab = function(result){ 
sforce.console.openSubtab(result.id,&apos;/apex/InvestigationSearch?id={!Case_Investigation__c.Id}&amp;inConsole=true&apos;, true, &apos;Merge Investigation&apos;, null); 
}; 
sforce.console.getEnclosingPrimaryTabId(openSubtab); 

} 
else{ 
window.open(&apos;/apex/InvestigationSearch?id={!Case_Investigation__c.Id}&amp;inConsole=false&apos;)
}*/

{!REQUIRESCRIPT(&quot;/soap/ajax/30.0/connection.js&quot;)}
{!REQUIRESCRIPT(&quot;/soap/ajax/30.0/apex.js&quot;)}
{!REQUIRESCRIPT(&quot;/support/console/28.0/integration.js&quot;)}

var user = sforce.connection.getUserInfo();
var userId = user.userId ;
//alert(userId);
var HavePermission= sforce.apex.execute(&quot;getBU_Utility&quot;,&quot;getInvestigationPrivilegesMerge&quot;, {UserId:userId});
//alert(userBU);
if(HavePermission== &apos;N&apos;){
alert(&apos;User is not authorized to create new Investigations. Please contact system admin&apos;);
}
else{
var InvId= &apos;{!Case_Investigation__c.Id}&apos;; 
alert(InvId);
var url=&apos;/apex/InvestigationMerge?InvId=&apos;+InvId+&apos;&amp;isdtp=vw&apos;;

if (sforce.console.isInConsole()) { 
srcUp(url);
} else { 
window.open(url,&apos;_blank&apos;);
}
}</url>
    </webLinks>
    <webLinks>
        <fullName>Open_Investigations</fullName>
        <availability>online</availability>
        <displayType>massActionButton</displayType>
        <encodingKey>UTF-8</encodingKey>
        <hasMenubar>false</hasMenubar>
        <hasScrollbars>true</hasScrollbars>
        <hasToolbar>false</hasToolbar>
        <height>600</height>
        <isResizable>true</isResizable>
        <linkType>url</linkType>
        <masterLabel>Open Investigations</masterLabel>
        <openType>newWindow</openType>
        <position>none</position>
        <protected>false</protected>
        <requireRowSelection>true</requireRowSelection>
        <showsLocation>false</showsLocation>
        <showsStatus>false</showsStatus>
        <url>{!Case_Investigation__c.Status__c} &lt;&gt; &quot;Closed&quot;</url>
    </webLinks>
    <webLinks>
        <fullName>Send_Mail</fullName>
        <availability>online</availability>
        <displayType>button</displayType>
        <encodingKey>UTF-8</encodingKey>
        <hasMenubar>false</hasMenubar>
        <hasScrollbars>true</hasScrollbars>
        <hasToolbar>false</hasToolbar>
        <height>600</height>
        <isResizable>true</isResizable>
        <linkType>url</linkType>
        <masterLabel>Send Mail</masterLabel>
        <openType>newWindow</openType>
        <position>none</position>
        <protected>false</protected>
        <showsLocation>false</showsLocation>
        <showsStatus>false</showsStatus>
        <url>/apex/InvestigationSendEmailCont?CaseInvestID={!Case_Investigation__c.Id}</url>
    </webLinks>
</CustomObject>
